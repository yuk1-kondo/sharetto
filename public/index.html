<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚‰ãã‚‰ãè»¢é€</title>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
  <style>
    /* èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .auth-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #4169E1 0%, #2E4BC6 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .auth-container {
      background: #FFFFFF;
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.2);
      text-align: center;
      max-width: 90%;
      width: 400px;
      border: 4px solid #4169E1;
    }
    
    .auth-title {
      font-size: 24px;
      margin-bottom: 16px;
      color: #4169E1;
      font-weight: 700;
    }
    
    .auth-subtitle {
      font-size: 16px;
      margin-bottom: 30px;
      color: #666;
      font-weight: 500;
    }
    
    .auth-input {
      width: 100%;
      padding: 16px;
      border: 3px solid #4169E1;
      border-radius: 16px;
      font-size: 18px;
      text-align: center;
      margin-bottom: 20px;
      outline: none;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }
    
    .auth-input:focus {
      border-color: #2E4BC6;
      box-shadow: 0 0 0 4px rgba(65, 105, 225, 0.1);
    }
    
    .auth-button {
      width: 100%;
      padding: 16px;
      background: #4169E1;
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 20px;
    }
    
    .auth-button:hover {
      background: #2E4BC6;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(65, 105, 225, 0.3);
    }
    
    .auth-button:active {
      transform: translateY(0);
    }
    
    .auth-error {
      color: #e74c3c;
      font-size: 14px;
      margin-top: 10px;
      display: none;
    }
    
    .auth-info {
      font-size: 14px;
      color: #7f8c8d;
      margin-top: 20px;
      padding: 16px;
      background: #f8fbff;
      border-radius: 12px;
      border-left: 4px solid #4169E1;
    }
    
    .main-content {
      display: none;
    }
    
    .main-content.authenticated {
      display: block;
    }

    body {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: #4169E1;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      color: #333;
    }
    .container {
      background: #FFFFFF;
      border-radius: 24px;
      padding: 40px;
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
      text-align: center;
      max-width: 90%;
      width: 500px;
      border: 4px solid #4169E1;
    }
    h1 {
      font-size: 20px;
      margin-bottom: 8px;
      color: #4169E1;
      font-weight: 700;
      line-height: 1.1;
      white-space: nowrap;
    }
    .qr-container {
      display: flex;
      justify-content: center;
      margin: 30px 0;
    }
    canvas {
      border: 6px solid #4169E1;
      border-radius: 20px;
      box-shadow: 0 8px 24px rgba(65, 105, 225, 0.3);
    }
    .note {
      font-size: 16px;
      margin: 20px 0;
      color: #4169E1;
      font-weight: 500;
    }

    #file-list {
      list-style: none;
      padding: 0;
      margin: 20px 0;
      text-align: left;
      max-height: 300px;
      overflow-y: auto;
      border-top: 1px solid #ddd;
    }
    #file-list li {
      padding: 12px;
      border-bottom: 1px solid #e8f4fd;
      display: flex;
      align-items: center;
      transition: background-color 0.3s ease;
    }
    #file-list li:hover {
      background-color: #f8fbff;
    }
    #file-list li a {
      color: #4169E1;
      text-decoration: none;
      word-break: break-all;
      flex-grow: 1;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    #file-list li a:hover {
      color: #2E4BC6;
      text-decoration: underline;
    }
    .file-icon {
      margin-right: 12px;
      width: 40px;
      height: 40px;
      background: #4169E1;
      color: white;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      flex-shrink: 0;
    }
    .file-thumbnail {
      margin-right: 12px;
      width: 40px;
      height: 40px;
      border-radius: 12px;
      object-fit: cover;
      border: 3px solid #4169E1;
      flex-shrink: 0;
    }
    .file-info {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
    }
    .file-name {
      font-weight: 500;
      margin-bottom: 2px;
    }
    .file-size {
      font-size: 12px;
      color: #7f8c8d;
    }
    .footer {
      margin-top: 30px;
      font-size: 14px;
      color: #FFFFFF;
      text-align: center;
      font-weight: 500;
    }
    .footer small {
      font-size: 12px;
      opacity: 0.8;
      margin-top: 4px;
      display: block;
    }
  </style>
</head>
<body>
  <!-- èªè¨¼ã‚·ã‚¹ãƒ†ãƒ  -->
  <div id="authOverlay" class="auth-overlay">
    <div class="auth-container">
      <h1 class="auth-title">ğŸ”’ ã‚‰ãã‚‰ãè»¢é€</h1>
      <p class="auth-subtitle">ã‚¢ã‚¯ã‚»ã‚¹èªè¨¼ãŒå¿…è¦ã§ã™</p>
      
      <input 
        type="password" 
        id="authInput" 
        class="auth-input" 
        placeholder="ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
        maxlength="8"
      >
      
      <button onclick="authenticate()" class="auth-button">
        ï¿½ ãƒ­ã‚°ã‚¤ãƒ³
      </button>
      
      <div id="authError" class="auth-error">
        ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“
      </div>
      
      <div class="auth-info">
        ğŸ’¡ å€‹äººåˆ©ç”¨ãƒ»ãƒ†ã‚¹ãƒˆç›®çš„ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™<br>
        ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãŠæŒã¡ã§ãªã„å ´åˆã¯<br>
        ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„
      </div>
    </div>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div id="mainContent" class="main-content">
    <div class="container">
      <h1>ï¿½ğŸ’» QRã§ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€ ğŸ“±</h1>
      <div class="qr-container">
        <canvas id="qr"></canvas>
      </div>
      <p class="note">â€»ã“ã®ã‚³ãƒ¼ãƒ‰ã¯ä¸€åº¦é™ã‚Šæœ‰åŠ¹ã§ã™</p>
      <div id="file-container">
        <ul id="file-list"></ul>
      </div>
    </div>
    <div class="footer">
      ã‚‰ãã‚‰ãè»¢é€ - ã‚¹ãƒãƒ›ã‹ã‚‰ãƒ‘ã‚½ã‚³ãƒ³ã¸ç°¡å˜ã«ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰<br>
      <small>Created by YUKI KONDO</small>
    </div>
  </div>

  <script>
    // èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 
    const ACCESS_CODES = [
      'yuki2025', // ãƒ¡ã‚¤ãƒ³ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ¼ãƒ‰
      'rakuraku', // ã‚µãƒ–ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ¼ãƒ‰
      'demo1234'  // ãƒ‡ãƒ¢ç”¨ã‚¢ã‚¯ã‚»ã‚¹ã‚³ãƒ¼ãƒ‰
    ];
    
    // èªè¨¼æˆåŠŸã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚­ãƒ¼
    const AUTH_SESSION_KEY = 'rakuraku_auth_session';
    const AUTH_EXPIRES_KEY = 'rakuraku_auth_expires';
    
    // èªè¨¼ã®æœ‰åŠ¹æœŸé™ï¼ˆ24æ™‚é–“ï¼‰
    const AUTH_DURATION = 24 * 60 * 60 * 1000; // 24æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
    
    function authenticate() {
      const input = document.getElementById('authInput');
      const error = document.getElementById('authError');
      const enteredCode = input.value.trim();
      
      if (ACCESS_CODES.includes(enteredCode)) {
        // èªè¨¼æˆåŠŸ
        const expiresAt = Date.now() + AUTH_DURATION;
        localStorage.setItem(AUTH_SESSION_KEY, 'authenticated');
        localStorage.setItem(AUTH_EXPIRES_KEY, expiresAt.toString());
        
        showMainContent();
        error.style.display = 'none';
        input.value = '';
      } else {
        // èªè¨¼å¤±æ•—
        error.style.display = 'block';
        input.value = '';
        input.focus();
        
        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’3ç§’å¾Œã«éš ã™
        setTimeout(() => {
          error.style.display = 'none';
        }, 3000);
      }
    }
    
    function showMainContent() {
      document.getElementById('authOverlay').style.display = 'none';
      document.getElementById('mainContent').classList.add('authenticated');
      
      // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
      initializeApp();
    }
    
    function checkAuthentication() {
      const authStatus = localStorage.getItem(AUTH_SESSION_KEY);
      const authExpires = localStorage.getItem(AUTH_EXPIRES_KEY);
      
      if (authStatus === 'authenticated' && authExpires) {
        const expiresAt = parseInt(authExpires);
        const now = Date.now();
        
        if (now < expiresAt) {
          // èªè¨¼ãŒæœ‰åŠ¹
          showMainContent();
          return true;
        } else {
          // èªè¨¼ãŒæœŸé™åˆ‡ã‚Œ
          localStorage.removeItem(AUTH_SESSION_KEY);
          localStorage.removeItem(AUTH_EXPIRES_KEY);
        }
      }
      
      // èªè¨¼ãŒå¿…è¦
      return false;
    }
    
    // Enterã‚­ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
    document.addEventListener('DOMContentLoaded', function() {
      const input = document.getElementById('authInput');
      if (input) {
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            authenticate();
          }
        });
      }
      
      // èªè¨¼çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
      if (!checkAuthentication()) {
        // èªè¨¼ç”»é¢ã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤ºã•ã‚Œã‚‹ï¼‰
        document.getElementById('authInput').focus();
      }
    });
  </script>

  <script type="module">
    // Firebase SDKã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    import { initializeApp as firebaseInitializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–é–¢æ•°ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
    window.initializeApp = function() {
      // Firebaseã®è¨­å®š
      const firebaseConfig = {
        apiKey: "AIzaSyD15hEPdpqiJAskraXETGDxhcow-aEN4VU",
        authDomain: "rakupic-19e91.firebaseapp.com",
        databaseURL: "https://rakupic-default-rtdb.firebaseio.com",
        projectId: "rakupic",
        storageBucket: "rakupic.firebasestorage.app",
        messagingSenderId: "1072420785155",
        appId: "1:1072420785155:web:2a57f7c1a5f4c81f121236"
      };

      // Firebaseã®åˆæœŸåŒ–
      const app = firebaseInitializeApp(firebaseConfig);
      const db = getDatabase(app);

      // ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã®ç”Ÿæˆï¼ˆ6æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ï¼‰
      const sessionId = Math.random().toString(36).substring(2, 8);
      
      // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã®URLã‚’ç”Ÿæˆ
      const uploadUrl = `${location.origin}/upload.html?session=${sessionId}`;
      
      // QRã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆ
      QRCode.toCanvas(document.getElementById("qr"), uploadUrl, {
        width: 200,
        margin: 1,
        color: {
          dark: '#000000',
          light: '#ffffff'
        }
      });

      // ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã®è¦ç´ ã‚’å–å¾—
      const fileList = document.getElementById("file-list");
      
      // Realtime Databaseã®å‚ç…§ã‚’ä½œæˆ
      const filesRef = ref(db, `files/${sessionId}`);
      
      // ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¿½åŠ ã•ã‚ŒãŸã¨ãã®ãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
      onChildAdded(filesRef, (snapshot) => {
        const fileData = snapshot.val();
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¨®é¡ã«å¿œã˜ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’æ±ºå®š
        let fileType = "FILE";
        let isImage = false;
        
        if (fileData.type) {
          if (fileData.type.startsWith("image/")) {
            fileType = "IMG";
            isImage = true;
          } else if (fileData.type.startsWith("video/")) {
            fileType = "VID";
          } else if (fileData.type.startsWith("audio/")) {
            fileType = "AUD";
          } else if (fileData.type.includes("pdf")) {
            fileType = "PDF";
          }
        }
        
        // ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½œæˆ
        const li = document.createElement("li");
        
        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
        const a = document.createElement("a");
        
        // Base64ãƒ‡ãƒ¼ã‚¿ã®å ´åˆã¯Blobã«å¤‰æ›ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        if (fileData.data && fileData.data.startsWith('data:')) {
          a.href = fileData.data; // Base64ãƒ‡ãƒ¼ã‚¿URLã‚’ãã®ã¾ã¾ä½¿ç”¨
        } else if (fileData.url) {
          a.href = fileData.url; // å¾“æ¥ã®URLæ–¹å¼
        } else {
          a.href = '#'; // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        }
        
        a.target = "_blank";
        a.download = fileData.name || "download";
        
        // ç”»åƒã®å ´åˆã¯ã‚µãƒ ãƒã‚¤ãƒ«ã‚’è¡¨ç¤ºã€ãã‚Œä»¥å¤–ã¯ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤º
        if (isImage && fileData.data) {
          const thumbnail = document.createElement("img");
          thumbnail.className = "file-thumbnail";
          thumbnail.src = fileData.data;
          thumbnail.alt = fileData.name || "ç”»åƒ";
          a.appendChild(thumbnail);
        } else {
          // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œæˆ
          const fileIcon = document.createElement("div");
          fileIcon.className = "file-icon";
          fileIcon.textContent = fileType;
          a.appendChild(fileIcon);
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’ä½œæˆ
        const fileInfo = document.createElement("div");
        fileInfo.className = "file-info";
        
        const fileName = document.createElement("div");
        fileName.className = "file-name";
        fileName.textContent = fileData.name || "ãƒ•ã‚¡ã‚¤ãƒ«";
        fileInfo.appendChild(fileName);
        
        const fileSize = document.createElement("div");
        fileSize.className = "file-size";
        fileSize.textContent = formatFileSize(fileData.size || 0);
        fileInfo.appendChild(fileSize);
        
        a.appendChild(fileInfo);
        li.appendChild(a);
        
        // ãƒªã‚¹ãƒˆã«è¿½åŠ 
        fileList.appendChild(li);
      });
      
      // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }
    }
  </script>
</body>
</html>
<!-- Cache busting: 2025-06-06 09:27 -->
